@base <https://tlds-demo.factsmission.org/renderers#>
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix gt: <http://rdf2h.github.io/2016/generic-rdf2h-renderers/> .
@prefix r2h: <http://rdf2h.github.io/2015/rdf2h#> .
@prefix dc: <http://dublincore.org/2012/06/14/dcelements#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix s: <http://schema.org/> .
@prefix geoch: <https://ld.geo.admin.ch/def/> .
@prefix opengis: <http://www.opengis.net/ont/geosparql#> .
@prefix gtfs:	<http://vocab.gtfs.org/terms#> .

<genericResource> a r2h:Renderer;
    r2h:type rdfs:Resource;
    r2h:context r2h:Default-Naked;
    r2h:javaScript """
        var prefixMappings = [{ns: "http://schema.org/", prefix: "s:"},
                        {ns: "http://www.w3.org/1999/02/22-rdf-syntax-ns#", prefix: "rdf:"},
                        {ns: "https://gont.ch/", prefix: "gont:"},
                        {ns: "http://www.w3.org/2004/02/skos/core#", prefix: "skos:"},
                        {ns: "http://www.w3.org/2002/07/owl#", prefix: "owl:"},
                        {ns: "http://dbpedia.org/resource/", prefix: "dbr:"},
                        {ns: "http://dbpedia.org/class/yago/", prefix: "yago:"},
                        {ns: "http://xmlns.com/foaf/0.1/", prefix: "foaf:"},
                        {ns: "http://www.wikidata.org/entity/", prefix: "wikidata:"},
                        {ns: "http://dbpedia.org/ontology/", prefix: "dbo:"},
                        {ns: "http://pns.org/dc/terms/", prefix: "dct:"},
                        {ns: "http://www.w3.org/2000/01/rdf-schema#", prefix: "rdfs:"}];
        function styleUri(uri) {
            var mapping = prefixMappings.find(function(mappping) {
                return uri.startsWith(mappping.ns);
            });
            if (mapping) {
                return mapping.prefix+"<b>"+uri.substring(mapping.ns.length)+"</b>";
            } else {
                return uri;
            }
        }
        var result = "";
        var predicatesArray = [];
        var nodesToRender = [];
        //should rather attach this to something specific to this RDF2h invocation
        console.log(env);
		if (!env.renderedNodesToId)  {
			env.renderedNodesToId = new Object();
		}

    """
.


[ a r2h:Renderer ;
    r2h:context gt:EmptyPage ;
    r2h:mustache """
    @prefix doap: <http://usefulinc.com/ns/doap#> .
    @prefix foaf: <http://xmlns.com/foaf/0.1/> .

    [ a doap:Project ;
      doap:name "TLDS demo " ;
      doap:shortdesc "A linked data explorer based on TLDS and data from geo.admin.ch." ;
      doap:description "A linked data explorer based on TLDS (https://github.com/linked-solutions/tlds) based on geographical data from geo.admin.ch. Configured in turtle." ;
      doap:homepage <https://tlds-demo.factsmission.org> ;
      doap:category <http://njh.me/Semantic Web> ;
      doap:programming-language "JAVA" ;
      doap:developer [
        a foaf:Person ;
        foaf:name "Factsmission" ;
        foaf:homepage <https://factsmission.com/>
      ] ;
      doap:repository [
        a doap:GitRepository ;
        doap:browse <https://github.com/factsmission/tlds-demo>
      ] .
    ].
    """
] .


[ a r2h:Renderer ;
    r2h:type opengis:Feature ;
    r2h:type s:provider ;
    r2h:type gtfs:Stop ;
    rdfs:comment "Renders a full page, delegating to renderers in the default \n    context for the body, and to gt:HtmlHead for things like the html title" ;
    r2h:context gt:FullPage ;
    r2h:mustache
        """
        {{{@prefix r2h: <http://rdf2h.github.io/2015/rdf2h#>}}}
        {{{@prefix gt: <http://rdf2h.github.io/2016/generic-rdf2h-Renderers/>}}}
        {{{@prefix s: <http://schema.org/>}}}
            <head>
              <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css"/>
              <!--<link rel='stylesheet' href='http://localhost:8080/style.css' />-->
              <title>{{.}}</title>
              <style></style>
            </head>
            <body>
              <div style="display: flex; min-height: 100vh; flex-direction: column;">
                <header class="ui container">
                  <div class="ui hidden divider"></div>
                  <div class="ui two column stackable grid">
                    <div class="four wide center aligned column"><img class="ui middle aligned image" src="https://upload.wikimedia.org/wikipedia/commons/3/3b/Flag-map_of_Switzerland.svg" onerror="this.onerror=null; this.src='https://upload.wikimedia.org/wikipedia/commons/3/3b/Flag-map_of_Switzerland.svg'" style=" height: auto; max-width: 400px; max-height: 120px;"></div>

                    <div class="ten wide column">
                      <h1>A new dress to geo.admin.ch</h1>
                      <p class='subheader'>Proudly turtle configurated</p>
                    </div>
                  </div>
                  <div class="ui hidden divider"></div>
                </header>
                <div class="ui container" style="flex: 1">
                  <div class="ui segment">
                    <div class="ui vertically divided grid">
                      {{{:render . r2h:Default}}}
                    </div>
                  </div>
                  <div class="ui hidden divider"></div>
                </div>
                <footer class="ui inverted vertical dividing footer segment form-page padded">
                  <div class="ui hidden divider"></div>
                  <div class="ui grid container">
                    <div class="ui eleven wide column">
                      <div class="ui container">
                        This project is a <a href="https://github.com/factsmission/tlds">TLDS</a> demo based on the data from <a href="https://www.geo.admin.ch">geo.admin.ch</a> by <a href="https://factsmission.com">FactsMission</a>.
                      </div>
                      <div class="ui hidden divider"></div>
                      <div class="ui aligned container">
                        Check the source-code on <a href="https://github.com/linked-solutions/tlds-demo" style="color: white;"><i class="large github icon"></i></a>
                        <div class="ui divider"></div>
                      </div>
                      <div class="ui container">
                        <small>Logo by <a href="https://en.wikipedia.org/wiki/File:Flag-map_of_Switzerland.svg">Wikimedia Commons</a> under <a href="https://creativecommons.org/licenses/by-sa/3.0/deed.en">Creative Commons Attribution-Share Alike 3.0 Unported</a> license.</small>
                      </div>
                    </div>
                    <div class="ui one wide column">
                      <a href="https://factsmission.com/"><img style="max-height:80px" src="https://factsmission.com/img/logo.svg"></a>
                    </div>
                  </div>
                  <div class="ui hidden divider"></div>
                </footer>


                <script type="application/ld+json">
                  {
                    "@context": "http://schema.org",
                    "@type": "WebSite",
                    "url": "https://localhost:5000",
                    "name": "ld.geo.admin.ch",
                    "creator": {
                      "@type": "Organization",
                      "name": "FactsMission",
                      "legalName": "FactsMission AG",
                      "url": "https://factsmission.com"
                    },
                    "description": "A demo of tlds.",
                    "inLanguage": "en"
                  }
                </script>
              </div>
            </body>""" ;
<http://rdf2h.github.io/2015/rdf2h#type>
        <http://www.w3.org/2000/01/rdf-schema#Resource>
] .


[ a       <http://rdf2h.github.io/2015/rdf2h#Renderer> ;
  <http://rdf2h.github.io/2015/rdf2h#context>
          <http://rdf2h.github.io/2015/rdf2h#Tail> ;
  <http://rdf2h.github.io/2015/rdf2h#mustache>
          "\n   {{{@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>}}}\n    {{#+rdfs:seeAlso}}\n      <div class=\"seeAlso\">\n        See also:\n        <ul>\n          {{#rdfs:seeAlso}}\n            <li>\n              <a href=\"{{{.}}}\">{{.}}</a>\n            </li>\n          {{/rdfs:seeAlso}}\n        </ul>\n      </div>\n    {{/+rdfs:seeAlso}}\n    {{#+rdfs:seeAlso<-}}\n      <div class=\"seeAlso\">\n        Inverse see also:\n        <ul>\n          {{#rdfs:seeAlso<-}}\n            <li>\n              <a href=\"{{{.}}}\">{{.}}</a>\n            </li>\n          {{/rdfs:seeAlso<-}}\n        </ul>\n      </div>\n    {{/+rdfs:seeAlso<-}}\n    " ;
  <http://rdf2h.github.io/2015/rdf2h#type>
          <http://schema.org/Article>
] .

<genericHead> a r2h:Renderer;
    r2h:type rdfs:Resource;
    r2h:context gt:HtmlHead;
    r2h:mustache """
        {{{:render . gt:HtmlTitle}}}
    """.

<genericHtmlTitle> a r2h:Renderer;
    r2h:type rdfs:Resource;
    r2h:context gt:HtmlTitle;
    r2h:mustache """
        <title>Resource: {{.}}</title>
    """.


[ a r2h:Renderer;
    r2h:type r2h:Resource ;
    r2h:type opengis:Feature ;
    r2h:type s:provider ;
    r2h:type gtfs:Stop ;
    r2h:context r2h:Default ;
    r2h:mustache """{{@prefix geo: <http://www.geonames.org/ontology#>}}
      {{@prefix rdf: <http://www.w3.org/2000/01/rdf-schema#>}}
      {{@prefix dc: <http://purl.org/dc/terms/>}}
      {{@prefix s: <http://schema.org/>}}
      {{@prefix rdfs: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>}}
      {{@prefix opengis: <http://www.opengis.net/ont/geosparql#>}}
      {{@prefix gt: <http://rdf2h.github.io/2016/generic-rdf2h-renderers/>}}
      {{@prefix wgs: <http://www.w3.org/2003/01/geo/wgs84_pos#>}}
      {{@prefix geotra: <https://ld.geo.admin.ch/def/transportation/>}}
      {{@prefix ldgeo: <https://ld.geo.admin.ch/def/>}}
      {{@prefix geo: <http://www.geonames.org/ontology#>}}

      {{#+s:hasMap}}
      {{{:render . opengis:FeatureMap}}}
      {{/+s:hasMap}}

      {{#+rdfs:type}}
      <div class="two column row">
        <div class="column four wide">
          <p>Class:</p>
        </div>
        <div class="column">
          {{#rdfs:type}}
          <p><b><a href="{{{.}}}">{{{.}}}</a></b></p>
          {{/rdfs:type}}
        </div>
      </div>
      {{/+rdfs:type}}

      {{#+s:name}}
      <div class="two column row">
        <div class="column four wide">
          <p>Has Name:</p>
        </div>
        <div class="column">
          <p><b>{{{s:name}}}</b></p>
        </div>
      </div>
      {{/+s:name}}

      {{#+s:alternateName}}
      <div class="two column row">
        <div class="column four wide">
          <p>Has Alternate Name:</p>
        </div>
        <div class="column">
          {{#s:alternateName}}
          <p><b>{{{:render . gt:Link}}}</b></p>
          {{/s:alternateName}}
        </div>
      </div>
      {{/+s:alternateName}}


      {{#+dc:identifier}}
      <div class="two column row">
        <div class="column four wide">
          <p>Has Identifier:</p>
        </div>
        <div class="column">
          <p><b>{{{dc:identifier}}}</b></p>
        </div>
      </div>
      {{/+dc:identifier}}

      {{#+ldgeo:bfsNumber}}
      <div class="two column row">
        <div class="column four wide">
          <p>Has Identifier:</p>
        </div>
        <div class="column">
          <p><b>{{{ldgeo:bfsNumber}}}</b></p>
        </div>
      </div>
      {{/+ldgeo:bfsNumber}}

      {{#+s:provider}}
      <div class="two column row">
        <div class="column four wide">
          <p>Has Provider:</p>
        </div>
        <div class="column">
          {{#s:provider}}
          <p><b>{{{:render . gt:Link}}}</b></p>
          {{/s:provider}}
        </div>
      </div>
      {{/+s:provider}}


      {{#+geo:parentCountry}}
      <div class="two column row">
        <div class="column four wide">
          <p>Parent Country:</p>
        </div>
        <div class="column">
          {{#geo:parentCountry}}
          <p><b>{{{:render . gt:Link}}}</b></p>
          {{/geo:parentCountry}}
        </div>
      </div>
      {{/+geo:parentCountry}}


      {{#+geo:parentADM1}}
      <div class="two column row">
        <div class="column four wide">
          <p>Has Parent ADM1:</p>
        </div>
        <div class="column">
          {{#geo:parentADM1}}
          <p><b>{{{:render . gt:Link}}}</b></p>
          {{/geo:parentADM1}}
        </div>
      </div>
      {{/+geo:parentADM1}}

      {{#+geo:parentADM2}}
      <div class="two column row">
        <div class="column four wide">
          <p>Has Parent ADM2:</p>
        </div>
        <div class="column">
          {{#geo:parentADM2}}
          <p><b>{{{:render . gt:Link}}}</b></p>
          {{/geo:parentADM2}}
        </div>
      </div>
      {{/+geo:parentADM2}}


      {{#+geo:population}}
      <div class="two column row">
        <div class="column four wide">
          <p>Has Population:</p>
        </div>
        <div class="column">
          <p><b>{{{geo:population}}}</b></p>
        </div>
      </div>
      {{/+geo:population}}


      {{#+wgs:long}}
      <div class="two column row">
        <div class="column four wide">
          <p>Has Localization:</p>
        </div>
        <div class="column">
          {{{:render . gt:Position}}}
        </div>
      </div>
      {{/+wgs:long}}

      {{#+opengis:hasGeometry}}
      <div class="two column row">
        <div class="column four wide">
          <p>Has Shape:</p>
        </div>
        <div class="column">
          <p><b>{{{:render . gt:Shape}}}</b></p>
        </div>
      </div>
      {{/+opengis:hasGeometry}}

      {{#+s:provider}}
      <div class="two column row">
        <div class="column four wide">
          <p>Has Provider:</p>
        </div>
        <div class="column">
          {{#s:provider}}
          <p><b>{{{:render . gt:Link}}}</b></p>
          {{/s:provider}}
        </div>
      </div>
      {{/+s:provider}}

      {{#+s:provider}}
      <div class="two column row">
        <div class="column four wide">
          <p>Has Provider:</p>
        </div>
        <div class="column">
          {{#s:provider}}
          <p><b>{{{:render . gt:Link}}}</b></p>
          {{/s:provider}}
        </div>
      </div>
      {{/+s:provider}}


      {{#+s:releaseDate}}
      <div class="two column row">
        <div class="column four wide">
          <p>Release Date:</p>
        </div>
        <div class="column">
          {{#s:releaseDate}}
          <p><b>{{{:render . gt:Date}}}</b></p>
          {{/s:releaseDate}}
        </div>
      </div>
      {{/+s:releaseDate}}

      {{#+s:dateModified}}
      <div class="two column row">
        <div class="column four wide">
          <p>Date Modified:</p>
        </div>
        <div class="column">
          {{#s:dateModified}}
          <p><b>{{{:render . gt:Date}}}</b></p>
          {{/s:dateModified}}
        </div>
      </div>
      {{/+s:dateModified}}

      {{#+s:validFrom}}
      <div class="two column row">
        <div class="column four wide">
          <p>Valid From:</p>
        </div>
        <div class="column">
          {{#s:validFrom}}
          <p><b>{{{:render . gt:Date}}}</b></p>
          {{/s:validFrom}}
        </div>
      </div>
      {{/+s:validFrom}}

      {{#+s:validUntil}}
      <div class="two column row">
        <div class="column four wide">
          <p>Valid Until:</p>
        </div>
        <div class="column">
          {{#s:validUntil}}
          <p><b>{{{:render . gt:Date}}}</b></p>
          {{/s:validUntil}}
        </div>
      </div>
      {{/+s:validUntil}}

      {{#+dc:issued}}
      <div class="two column row">
        <div class="column four wide">
          <p>Issued:</p>
        </div>
        <div class="column">
          {{#dc:issued}}
          <p><b>{{{:render . gt:Date}}}</b></p>
          {{/dc:issued}}
        </div>
      </div>
      {{/+dc:issued}}

      {{#+geotra:meansOfTransportation}}
      <div class="two column row">
        <div class="column four wide">
          <p>Has Means of Transportation:</p>
        </div>
        <div class="column">
          {{#geotra:meansOfTransportation}}
          <p><b>{{{:render . gt:Link}}}</b></p>
          {{/geotra:meansOfTransportation}}
        </div>
      </div>
      {{/+geotra:meansOfTransportation}}


      {{#+geo:countryCode}}
      <div class="two column row">
        <div class="column four wide">
          <p>Country code:</p>
        </div>
        <div class="column">
          <p><b>{{{geo:countryCode}}}</b></p>
        </div>
      </div>
      {{/+geo:countryCode}}

      {{#+rdf:seeAlso}}
      <div class="two column row">
        <div class="column four wide">
          <p>See also:</p>
        </div>
        <div class="column">
          {{#rdf:seeAlso}}
          <p><b><a href="{{{.}}}">{{{.}}}</a></b></p>
          {{/rdf:seeAlso}}
        </div>
      </div>
      {{/+rdf:seeAlso}}

      {{#+dc:hasVersion}}
      <div class="two column row">
        <div class="column four wide">
          <p>Has Version:</p>
        </div>
        <div class="column">
          {{#dc:hasVersion}}
          <p><b>{{{:render . gt:Link}}}</b></p>
          {{/dc:hasVersion}}
        </div>
      </div>
      {{/+dc:hasVersion}}

      {{#+dc:isVersionOf}}
      <div class="two column row">
        <div class="column four wide">
          <p>Is Version Of:</p>
        </div>
        <div class="column">
          {{#dc:isVersionOf}}
          <p><b>{{{:render . gt:Link}}}</b></p>
          {{/dc:isVersionOf}}
        </div>
      </div>
      {{/+dc:isVersionOf}}

      {{#+s:sameAs}}
      <div class="two column row">
        <div class="column four wide">
          <p>Same As:</p>
        </div>
        <div class="column">
          {{#s:sameAs}}
          <p><b>{{{:render . gt:Link}}}</b></p>
          {{/s:sameAs}}
        </div>
      </div>
      {{/+s:sameAs}}
      """
] .

[ a r2h:Renderer ;
    r2h:type rdfs:Resource ;
    r2h:context gt:Link ;
    r2h:mustache """
	  <a href="{{.}}">{{{.}}}</a>
    """
].

[ a r2h:Renderer ;
    r2h:type <http://www.w3.org/2001/XMLSchema#date> ;
    r2h:type <http://www.w3.org/2001/XMLSchema#string> ;
    r2h:context gt:Date ;
    r2h:mustache """
	  {{{.}}}
    """
].


[ a r2h:Renderer ;
    r2h:type <http://www.w3.org/2000/01/rdf-schema#Resource> ;
    r2h:context gt:Position ;
    r2h:mustache """{{@prefix wgs: <http://www.w3.org/2003/01/geo/wgs84_pos#>}}
    {{@prefix dbo: <http://dbpedia.org/ontology/>}}
    {{@prefix geotra: <https://ld.geo.admin.ch/def/transportation/>}}
    {{@prefix gt: <http://rdf2h.github.io/2016/generic-rdf2h-renderers/>}}
    {{@prefix s: <http://schema.org/>}}


	  <p><b>Lat-Long:</b>  <a href="https://www.openstreetmap.org/#map=15/{{{wgs:long}}}/{{{wgs:long}}}">{{{wgs:long}}},{{{wgs:long}}}</a></p>
    <p><b>Elevation: </b>{{{dbo:elevation}}}m</p>
    <p><b>Operating Point Type:</b>{{#geotra:operatingPointType}}{{{:render . gt:Link}}}{{/geotra:operatingPointType}}</p>
    <p><b>Contained in Place: </b>{{#s:containedInPlace}}{{{:render . gt:Link}}}{{/s:containedInPlace}}</p>

    """
].



[ a r2h:Renderer ;
    r2h:type rdfs:Resource  ;
    r2h:context gt:Shape ;
    r2h:mustache """
    {{@prefix opengis: <http://www.opengis.net/ont/geosparql#>}}
    {{@prefix geodef: <https://ld.geo.admin.ch/def/lakeArea>}}
    {{@prefix dbp: <http://dbpedia.org/property/>}}
    {{@prefix gt: <http://rdf2h.github.io/2016/generic-rdf2h-renderers/>}}


    {{#opengis:hasGeometry}}<p><b>Geometry: </b>{{{:render . gt:Link}}}</p>{{/opengis:hasGeometry}}
    {{#+opengis:asWKT}}
    <p><b>WKT: </b>{{#opengis:asWKT}}{{{:render . gt:Link}}}{{/opengis:asWKT}}</p>
    {{/+opengis:asWKT}}
    {{#+dbp:area}}<p><b>Area: </b>{{dbp:area}}</p>{{/+dbp:area}}
    {{#+geodef:lakeArea}}<p><b>Lake area: </b>{{geodef:lakeArea}}</p>{{/+geodef:lakeArea}}

    """
].

[ a r2h:Renderer ;
    r2h:type rdfs:Resource ;
    r2h:context opengis:FeatureMap ;
    r2h:javaScript """
    let s = suffix => $rdf.sym("http://schema.org/"+suffix);
    let map = n.out(s("hasMap")).value.replace('https://map.geo.admin.ch/', 'https://map.geo.admin.ch/embed.html');
    let iframe = `<iframe src='${map}' width='940' height='400' frameborder='0' style='border:0'></iframe>`
    print(iframe);
    """
].
